language: python

cache: pip

services:
  - redis-server

python:
  - "3.3"
  - "3.4"
  - "3.5"
  - "3.5-dev"
  - "nightly"

install:
  - pip install coveralls
  - pip install codecov
  - pip install .
  - cp travis_config/uwhoisd.ini extra/uwhoisd.ini
  - pushd client
  - pip install .
  - popd

script:
  - coverage run --parallel-mode --source=uwhoisd uwhoisd/__init__.py extra/uwhoisd.ini &
  - pid=$!
  - sleep 5
  - nosetests --with-coverage --cover-package=uwhoisd
  - kill -s INT $pid
  - coverage combine .coverage*

after_success:
  - codecov
  - coveralls
